# YOLOv8 X-Ray Anomaly Detection - C·∫•u h√¨nh v·ªõi DynamicHead Head
# D·ª±a tr√™n yolov8-xray-anomaly_Goc.yaml
# Ultralytics YOLO üöÄ, AGPL-3.0 license

# Parameters
nc: 14  # s·ªë l∆∞·ª£ng classes cho X-quang
depth_multiple: 0.67
width_multiple: 0.75
max_channels: 768

# C√°c th√¥ng s·ªë li√™n quan ƒë·∫øn loss v√† assign strategy
loss: 'Focal_WIoU'  # Gi·ªØ nguy√™n loss, ph√π h·ª£p cho ƒë·ªëi t∆∞·ª£ng nh·ªè v√† kh√≥
newhead: DynamicHead  # Thay ƒë·ªïi head th√†nh DynamicHead

# YOLOv8 backbone
backbone:
  # [from, repeats, module, args]
  - [-1, 1, Conv, [64, 3, 2]]  # 0-P1/2
  - [-1, 1, Conv, [128, 3, 2]]  # 1-P2/4
  - [-1, 3, C2f, [128, True]]  # 2
  - [-1, 1, Conv, [256, 3, 2]]  # 3-P3/8
  - [-1, 6, C2f, [256, True]]  # 4 - S·ª≠ d·ª•ng C2f ti√™u chu·∫©n cho ·ªïn ƒë·ªãnh
  - [-1, 1, Conv, [512, 3, 2]]  # 5-P4/16
  - [-1, 6, C2f, [512, True]]  # 6
  - [-1, 1, Conv, [1024, 3, 2]]  # 7-P5/32
  - [-1, 3, C2f, [1024, True]]  # 8
  - [-1, 1, SPPFCSPC, [1024]]  # 9 - C·∫£i thi·ªán SPPF v·ªõi SPPFCSPC cho ƒëa t·ª∑ l·ªá t·ªët h∆°n

# YOLOv8 head - tƒÉng c∆∞·ªùng v·ªõi FocalNeXt v√† CBAM
head:
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]  # 10
  - [[-1, 6], 1, Concat, [1]]  # 11 (P4)
  - [-1, 3, C2f, [512]]  # 12

  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]  # 13
  - [[-1, 4], 1, Concat, [1]]  # 14 (P3)
  - [-1, 3, C2f_FocalNeXt, [256]]  # 15 (P3/8-small) - FocalNeXt t·ªët cho ph√°t hi·ªán chi ti·∫øt nh·ªè
  - [-1, 1, CBAM, [256]]  # 16 (P3) - CBAM tƒÉng c∆∞·ªùng ph√¢n bi·ªát v√πng quan tr·ªçng

  - [-1, 1, Conv, [256, 3, 2]]  # 17
  - [[-1, 12], 1, Concat, [1]]  # 18 (P4)
  - [-1, 3, C2f_FocalNeXt, [512]]  # 19 (P4/16-medium) - FocalNeXt cho P4
  - [-1, 1, CBAM, [512]]  # 20 (P4) - CBAM tƒÉng c∆∞·ªùng P4

  - [-1, 1, Conv, [512, 3, 2]]  # 21
  - [[-1, 9], 1, Concat, [1]]  # 22 (P5)
  - [-1, 3, C2f_FocalNeXt, [1024]]  # 23 (P5/32-large) - FocalNeXt cho P5
  - [-1, 1, CBAM, [1024]]  # 24 (P5) - CBAM tƒÉng c∆∞·ªùng P5

  # L·ªõp Detect s·∫Ω t·ª± ƒë·ªông s·ª≠ d·ª•ng DynamicHead do tham s·ªë 'newhead' ·ªü tr√™n
  - [[16, 20, 24], 1, Detect, [nc]]  # Detect(P3-CBAM, P4-CBAM, P5-CBAM)